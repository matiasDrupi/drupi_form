<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Drupi_Formulario_Sticky</title>

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;500&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://api.fontshare.com/v2/css?f[]=switzer@400,500,600,700&display=swap" rel="stylesheet">

    <style>
        /* Estilos CSS - Mantenidos del formulario anterior */
        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            background: #000;
            width: 100%;
            padding: 1rem 0;
            text-align: center;
        }

        header h1 {
            margin: 0;
            font-family: 'Switzer', sans-serif;
            font-size: 32px;
            font-weight: 600;
            color: #ededed;
        }

        header h2 {
            margin: 0;
            font-family: 'Switzer', sans-serif;
            font-size: 15px;
            font-weight: 600;
            color: #ededed;
        }

        .container {
            background: #fff;
            margin-top: 2rem;
            padding: 1.5rem; /* Ajustado para coincidir con el formulario anterior */
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 90%; /* Ajustamos el ancho para centrar mejor */
            max-width: 500px; /* Reducimos el ancho máximo */
            display: flex; /* Usamos flexbox para controlar el alineamiento de los elementos internos */
            flex-direction: column; /* Aseguramos que los elementos internos se apilen verticalmente */
            align-items: stretch; /* Estiramos los elementos internos para que ocupen el ancho del contenedor */
        }

        .chat-id-container {
            background: #fff; /* Mismo fondo que el contenedor principal para integrarlo mejor */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem; /* Separación del resto del formulario */
            text-align: left; /* Alinea la etiqueta a la izquierda */
        }
        .chat-id-input-group {
            display: flex;
            flex-direction: column;
        }
        .chat-id-input-group label {
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }
        .chat-id-input-group input {
            padding: 0.7rem;
            border: 1px solid #aaa;
            border-radius: 0.3rem;
            font-size: 1rem;
        }
        .separator {
            border-bottom: 1px solid #ccc;
            margin: 1.5rem 0;
        }

        label {
            display: block;
            margin: 1rem 0 0.5rem; /* Mantenido del formulario anterior */
            font-weight: 500;
        }

        input, select, textarea {
            width: calc(100% - 10px); /* Mantenido del formulario anterior */
            padding: 0.6rem; /* Mantenido del formulario anterior */
            border-radius: 0.5rem;
            border: 1px solid #ccc;
            font-size: 0.9rem; /* Mantenido del formulario anterior */
        }

        input[type="file"] {
            padding: 0.6rem; /* Ajustado para coincidir con el padding general */
        }

        button {
            margin-top: 1.5rem; /* Ajustado para coincidir con el formulario anterior */
            padding: 0.8rem; /* Mantenido del formulario anterior */
            width: 100%;
            background: #6200ea;
            color: white;
            font-size: 1rem; /* Mantenido del formulario anterior */
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>

<body>
    <header>
        <h1>Drupi</h1>
        <h2>Sticky</h2>
    </header>

    <div class="container">
        <div class="chat-id-container">
            <div class="chat-id-input-group">
                <label for="chat_id">Tu Chat ID de Telegram</label>
                <input type="text" id="chat_id" name="chat_id" placeholder="Ingresa tu Chat ID" required />
            </div>
        </div>
        <div class="separator"></div>

        <form id="drupiForm">
            <label for="nombre_sitio_web">Nombre del sitio web</label>
            <input type="text" id="nombre_sitio_web" name="nombre_sitio_web" placeholder="drupi.io" required />

            <label for="instagram_perfil">Perfil de Instagram</label>
            <input type="text" id="instagram_perfil" name="instagram_perfil" placeholder="@nombreperfil" required />

            <label for="foto_perfil_instagram">Foto de perfil Instagram</label>
            <input type="file" id="foto_perfil_instagram" name="foto_perfil_instagram" accept="image/*" placeholder="Subí la foto de perfíl" required />

            <label for="usuario_verificado_instagram">Usuario verificado en Instagram</label>
            <select id="usuario_verificado_instagram" name="usuario_verificado_instagram" placeholder="¿Es usuario verificado? ¿Color de insignia?" required>
                <option value="">Seleccionar</option>
                <option value="Azul">Azul</option>
                <option value="Blanco">Blanco</option>
                <option value="No">No</option>
            </select>

            <label for="titulo1">Título 1</label>
            <input type="text" id="titulo1" name="titulo1" placeholder="Escribí un título" required />

            <label for="foto_perfil_marca">Foto de perfil marca</label>
            <input type="file" id="foto_perfil_marca" name="foto_perfil_marca" accept="image/*" placeholder="Subí la foto de perfíl de la marca" required />

            <label for="sticky_foto_marca">Sticky foto marca</label>
            <input type="file" id="sticky_foto_marca" name="sticky_foto_marca" accept="image/*" placeholder="Subí la foto de la segunda marca" required />

            <label for="video_1">Video 1 (link)</label>
            <input type="url" id="video_1" name="video_1" placeholder="https://www.instagram.com/..." required />

            <label for="video_2">Video 2 (link)</label>
            <input type="url" id="video_2" name="video_2" placeholder="https://www.instagram.com/..." required />

            <label for="video_3">Video 3 (link)</label>
            <input type="url" id="video_3" name="video_3" placeholder="https://www.instagram.com/..." required />

            <label for="video_destacado_1">Video destacado 1 (link)</label>
            <input type="url" id="video_destacado_1" name="video_destacado_1" placeholder="https://www.instagram.com/..." required />

            <label for="caption_1">Caption 1</label>
            <input type="text" id="caption_1" name="caption_1" placeholder="Escribí una frase para tu video destacado." required />

            <label for="video_destacado_2">Video destacado 2 (link)</label>
            <input type="url" id="video_destacado_2" name="video_destacado_2" placeholder="https://www.instagram.com/..." required />

            <label for="caption_2">Caption 2</label>
            <input type="text" id="caption_2" name="caption_2" placeholder="Escribí una frase para tu video destacado." required />

            <label for="captura_web_mobile">Captura web mobile</label>
            <input type="file" id="captura_web_mobile" name="captura_web_mobile" accept="image/*" placeholder="Subí la foto de la captura vertical del sitio web" required />

            <button type="submit" id="submitBtn" disabled>Enviar</button>
        </form>
    </div>

    <script>
        // Obtiene referencias al formulario y al botón de envío
        const form = document.getElementById('drupiForm');
        const submitBtn = document.getElementById('submitBtn');
        const chatIdInput = document.getElementById('chat_id'); // Referencia al input del chat ID
        const videoInputs = document.querySelectorAll('input[type="url"]'); // Selecciona todos los inputs de tipo URL

        // Función para verificar si todos los campos requeridos están llenos
        function areAllRequiredFilled() {
            // Obtiene todos los elementos del formulario que tienen el atributo 'required'
            const requiredFields = form.querySelectorAll('[required]');
            // Itera sobre cada campo requerido y verifica si su valor no está vacío
            // Para los inputs de tipo 'file', verifica si se ha seleccionado al menos un archivo
            return Array.from(requiredFields).every(input => {
                if (input.type === 'file') {
                    return input.files.length > 0;
                } else {
                    return input.value.trim() !== '';
                }
            });
        }

        // Función para habilitar o deshabilitar el botón de envío
        function toggleSubmitButton() {
            submitBtn.disabled = !areAllRequiredFilled();
        }

        // Agrega un listener al evento 'input' del formulario
        // Cada vez que cambia el valor de un input, se verifica si todos los campos requeridos están llenos
        form.addEventListener('input', toggleSubmitButton);

        // Llama a la función para establecer el estado inicial del botón al cargar la página
        toggleSubmitButton();

        // Obtener el contenido del h2
        const h2Content = document.querySelector('header h2').textContent;

        // Agrega un listener al evento 'submit' del formulario
        form.addEventListener('submit', async (e) => {
            // Evita el envío tradicional del formulario
            e.preventDefault();
            // Crea un objeto FormData para enviar los datos del formulario (incluidos los archivos)
            const formData = new FormData(form);

            // **AGREGANDO EL CHAT ID AL FORMDATA**
            formData.append('chat_id', chatIdInput.value.trim());

            // **FORMATEANDO LAS URLs DE INSTAGRAM PARA APPIFY**
            const directUrls = [];
            videoInputs.forEach(input => {
                if (input.name.startsWith('video') && input.value.trim()) {
                    let url = input.value.trim();
                    if (!url.startsWith('https://')) {
                        url = `https://${url}`;
                    }
                    directUrls.push(url);
                }
            });
            formData.append('directUrls', JSON.stringify(directUrls)); // Apify espera un array de URLs

            // Agrega el contenido de h2 al formData
            formData.append('h2', h2Content);

            try {
                // Realiza una petición POST asíncrona a la URL del webhook
                const response = await fetch('https://hook.us2.make.com/3t7orr97ovdbgjyvrv7cvpf1fy9m4bff', {
                    method: 'POST',
                    body: formData, // Envía el objeto FormData directamente (soporta archivos)
                });

                // Si la respuesta del servidor es exitosa
                if (response.ok) {
                    alert('Formulario enviado correctamente.');
                    form.reset(); // Restablece el formulario
                    toggleSubmitButton(); // Deshabilita el botón después del envío
                } else {
                    // Si hubo un error en la respuesta del servidor
                    const errorData = await response.json();
                    console.error('Error al enviar el formulario:', errorData);
                    alert('Error al enviar el formulario: ' + (errorData.message || 'Intenta nuevamente.'));
                }
            } catch (err) {
                // Si ocurre un error de red
                alert('Error de red al enviar. Intenta nuevamente.');
                console.error(err);
            }
        });
    </script>
</body>
</html>